/*
 * feedbackbox
 *
 * @version    1.0.0
 * @package    mod_feedbackbox
 * @author     Vincent Schneider <vincent.schneider@sudile.com> 2020
 * @copyright  2020 Sudile GbR (http://www.sudile.com)
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_feedbackbox/chartview",["jquery","core/ajax","mod_feedbackbox/chart"],(function($,ajax,Chart){var images=[],roundstr="";return{init:function(feedbackboxid,action,mixedvalue,roundstring){if(roundstr=roundstring,$("#feedbackboxicons").children().each((function(){var src,request;src=$(this).attr("src"),(request=new XMLHttpRequest).open("GET",src,!1),request.onload=function(){var inlineSVG=(new DOMParser).parseFromString(request.responseText,"text/xml").getElementsByTagName("svg")[0];inlineSVG.setAttribute("width","48px"),inlineSVG.setAttribute("height","48px");var img64="data:image/svg+xml;base64,"+btoa((new XMLSerializer).serializeToString(inlineSVG)),image=new Image;image.src=img64,image.onload=function(){var canvas=document.createElement("canvas");canvas.width=this.width,canvas.height=this.height,canvas.getContext("2d").drawImage(this,0,0);var img=new Image;img.src=canvas.toDataURL("image/png"),images.push(img)}},request.send()})),"single"===action){ajax.call([{methodname:"mod_feedbackbox_chartdata_single",args:{feedbackboxid:feedbackboxid,turnus:mixedvalue}}])[0].done((function(response){let ctxc=$("#studchart");new Chart(ctxc,{type:"bar",plugins:[{afterDraw:chart=>{var ctx=chart.chart.ctx,xAxis=chart.scales["x-axis-0"],yAxis=chart.scales["y-axis-0"];yAxis.ticks.forEach(((value,index)=>{if(index in images){var x=xAxis.getPixelForTick(index);ctx.drawImage(images[index],x-15,yAxis.bottom,30,30)}}))}}],data:{labels:["","","",""],datasets:[{data:response.data,maxBarThickness:50}]},options:{responsive:!0,maintainAspectRatio:!1,legend:{display:!1},tooltips:{enabled:!0},elements:{rectangle:{backgroundColor:"rgba(255, 172, 37, 0.2)",borderColor:"rgba(255, 172, 37, 1)",borderWidth:2}},scales:{yAxes:[{display:!1,gridLines:{display:!1},ticks:{suggestedMin:0}}],xAxes:[{gridLines:{display:!1}}]}}})}))}else{ajax.call([{methodname:"mod_feedbackbox_chartdata_multiple",args:{feedbackboxid:feedbackboxid}}])[0].done((function(response){let datarounds=[],dataparticipants=[],datarating=[],counter=1;response.data.forEach((function(entry){dataparticipants.push(entry.participants),datarating.push(entry.rating),datarounds.push(roundstr+" "+counter++)}));let ctxp=$("#participants"),ctxc=(new Chart(ctxp,{type:"bar",data:{labels:datarounds,datasets:[{data:dataparticipants,maxBarThickness:50}]},options:{legend:{display:!1},tooltips:{enabled:!0},scales:{yAxes:[{display:!0,ticks:{suggestedMin:0,suggestedMax:mixedvalue,callback:function(value){if(value%1==0)return value}},gridLines:{display:!1}}],xAxes:[{gridLines:{display:!1}}]},elements:{rectangle:{backgroundColor:"rgba(164, 164, 164, 0.2)",borderColor:"rgba(164, 164, 164, 1)",borderWidth:2}},maintainAspectRatio:!1}}),$("#coursehealth"));new Chart(ctxc,{type:"bar",plugins:[{afterDraw:chart=>{var ctx=chart.chart.ctx,yAxis=chart.scales["y-axis-0"];yAxis.ticks.forEach(((value,index)=>{if(value>=1&&value<=4&&value%1==0){var y=yAxis.getPixelForTick(index);ctx.drawImage(images[images.length-value],0,y,30,30)}}))}}],data:{labels:datarounds,datasets:[{data:datarating,maxBarThickness:50}]},options:{layout:{padding:{left:30}},legend:{display:!1},tooltips:{enabled:!0},scales:{yAxes:[{display:!1,ticks:{beginAtZero:!1,suggestedMin:1,suggestedMax:4,callback:function(value){if(value%1==0)return value}},gridLines:{display:!1}}],xAxes:[{gridLines:{display:!1}}]},elements:{rectangle:{backgroundColor:"rgba(255, 172, 37, 0.2)",borderColor:"rgba(255, 172, 37, 1)",borderWidth:2}},maintainAspectRatio:!1}})}))}}}}));

//# sourceMappingURL=chartview.min.js.map